{{- $cicdDeploymentClusterRole := .Values.cicdDeploymentClusterRole }}
{{- $rendered := tpl $cicdDeploymentClusterRole . }}
{{- $rendered | nindent 0 }}

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: cicd-deployment-clusterrolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cicd-deployment-clusterrole
subjects:
  - apiGroup: rbac.authorization.k8s.io
    kind: Group
    name: cicd-deployment

___

cicdDeploymentClusterRole: |
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    name: cicd-deployment-clusterrole
  rules:
    - apiGroups: ['']
      resources: ['namespaces', 'secrets', 'configmaps', 'services', 'pods', 'pods/log', 'events', 'serviceaccounts', 'persistentvolumeclaims']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['apps']
      resources: ['deployments', 'deployments/scale']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['autoscaling']
      resources: ['horizontalpodautoscalers']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['networking.k8s.io']
      resources: ['ingresses']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['keda.sh']
      resources: ['scaledobjects']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['datadogh1.com']
      resources: ['datadogmonitors']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['eks.services.k8s.aws']
      resources: ['podidentityassociations']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['iam.services.k8s.aws']
      resources: ['roles']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['rbac.authorization.k8s.io']
      resources: ['roles', 'rolebindings', 'clusterroles', 'clusterrolebindings']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups" ['argoproj.io']
      resources: ['rollouts', 'experiments', 'analysisruns', 'rollout/status', 'eventresources', 'sensors', 'workflowtemplates']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['storage.k8s.io']
      resources: ['storageclasses', 'persistentvolumeclaims']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['gateway.solo.io']
      resources: ['virtualservices', 'gateways', 'routetables', 'authconfigs', 'upstreams', 'proxies', 'ratelimits', 'authconfigs', 'ratelimitconfigs', 'upstreamgroups', 'upstreamgroups/status', 'upstreamgroups/finalizers']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['gloo.solo.io']
      resources: ['virtualservices', 'gateways', 'routetables', 'authconfigs', 'upstreams', 'proxies', 'ratelimits', 'authconfigs', 'ratelimitconfigs', 'upstreamgroups', 'upstreamgroups/status', 'upstreamgroups/finalizers']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['argoproj.io']
      resources: ['workflows', 'workflowtemplates', 'cronworkflows', 'cronworkflowtemplates', 'workflowtaskresults']
      verbs: ['*', 'patch', 'create']
    - apiGroups: ['batch']
      resources: ['cronjobs']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']

cicdNsDeploymentClusterRole: |
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    name: cicd-ns-deployment-clusterrole
  rules:
    - apiGroups: ['']
      resources: ['namespaces', 'resourcequotas', 'limitranges', 'serviceaccounts', 'secrets']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['rbac.authorization.k8s.io']
      resources: ['roles', 'rolebindings', 'clusterroles', 'clusterrolebindings']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['networking.k8s.io']
      resources: ['networkpolicies']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['keda.sh']
      resources: ['scaledobjects']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['argoproj.io']
      resources: ['eventbus']
      verbs: ['create', 'update', 'patch', 'delete', 'get', 'list', 'watch']
    - apiGroups: ['']
      resources: ['pods', 'configmaps', ''secrets, 'serviceaccounts', 'services']
      verbs: ['delete']
    - apiGroups: ['']

developerClusterRole: |
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    name: developer-cluster-role
  rules:
    - apiGroups: ['']
      resources: ['namespaces
      verbs: ['get', 'list', 'watch']

operatorClusterRole: |
  apiVersion: rbac.authorization.k8s.io/v1
  kind: ClusterRole
  metadata:
    name: operator-cluster-role
  rules:
    - apiGroups: ['']
      resources: ['bindings', 'componentstatuses', 'configmaps', 'endpoints', 'events', 'limitranges', 'namespaces', 'nodes', 'persistentvolumeclaims', 'persistentvolumes', 'pods', 'podtemplates', 'replicationcontrollers', 'resourcequotas', 'serviceaccounts', 'services', 'pods/log']
      verbs: ['get', 'list', 'watch']
    - apiGroups: ['apps', 'batch', 'extensions', 'autoscaling', 'policy', 'networking.k8s.io', 'rabc.authorization.k8s.io', 'storage.k8s.io','apiextensions.k8s.io', 'admissionregistration.k8s.io', 'scheduling.k8s.io', 'coordination.k8s.io', 'node.k8s.io', 'certificates.k8s.io', 'datadoghq.com', 'keda.sh', 'metrics.k8s.io', 'argoproj.io', 'gateway.solo.io', 'gloo.solo.io']
      resources: ['*']
      verbs: ['get', 'list', 'watch']
    - apiGroups: ['apps']
      resources: ['deployments', 'deployments/scale']
      verbs: ['update', 'patch']
    - apiGroups: ['authorization.k8s.io']
      resources: ['selfsubjectrulesreviews', 'subjectaccessreviews']
      verbs: ['create']
